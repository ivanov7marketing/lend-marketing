import"./modulepreload-polyfill-B5Qt9EMX.js";document.addEventListener("DOMContentLoaded",async()=>{const l=document.getElementById("config-form"),s=document.getElementById("save-btn"),r=document.getElementById("save-status"),d=document.querySelectorAll('.sidebar-nav a[href^="#"]');let c={theme:{},content:{}};try{const t=await fetch("/api/config");t.ok?(c=await t.json(),u(c)):t.status===401&&window.location.reload()}catch(t){console.error("Failed to load config",t),i("Ошибка загрузки","error")}document.querySelectorAll('input[type="color"]').forEach(t=>{const n=t.nextElementSibling;t.addEventListener("input",e=>{n.value=e.target.value})});function u(t){for(const[n,e]of Object.entries(t.theme||{})){const o=document.getElementById(`theme.${n}`);if(o&&(o.value=e,o.type==="color")){const a=o.nextElementSibling;a&&a.classList.contains("color-text")&&(a.value=e)}}for(const[n,e]of Object.entries(t.content||{})){const o=document.getElementById(`content.${n}`);o&&(o.value=e)}}s.addEventListener("click",async()=>{s.disabled=!0,s.textContent="Сохранение...";const t={theme:{...c.theme},content:{...c.content}},n=new FormData(l);for(const[e,o]of n.entries())e.endsWith("-text")||(e.startsWith("theme.")?t.theme[e.replace("theme.","")]=o:e.startsWith("content.")&&(t.content[e.replace("content.","")]=o));try{(await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?(c=t,i("Успешно сохранено!","success")):i("Ошибка при сохранении","error")}catch(e){console.error("Failed to save",e),i("Ошибка сети","error")}finally{s.disabled=!1,s.textContent="Сохранить изменения"}});function i(t,n){r.textContent=t,r.className=`status-msg show status-${n}`,setTimeout(()=>{r.classList.remove("show")},3e3)}const f=document.querySelectorAll(".config-section");document.querySelector(".main-content"),window.addEventListener("scroll",()=>{let t="";f.forEach(n=>{const e=n.offsetTop;window.scrollY>=e-100&&(t=n.getAttribute("id"))}),d.forEach(n=>{n.classList.remove("active"),n.getAttribute("href")===`#${t}`&&n.classList.add("active")})})});
